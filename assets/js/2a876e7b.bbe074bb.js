"use strict";(self.webpackChunkhousing_repairs_online=self.webpackChunkhousing_repairs_online||[]).push([[4063],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return c}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),m=p(n),c=r,k=m["".concat(s,".").concat(c)]||m[c]||d[c]||i;return n?a.createElement(k,o(o({ref:t},u),{},{components:n})):a.createElement(k,o({ref:t},u))}));function c(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var p=2;p<i;p++)o[p]=n[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},1352:function(e,t,n){n.r(t),n.d(t,{assets:function(){return s},contentTitle:function(){return o},default:function(){return d},frontMatter:function(){return i},metadata:function(){return l},toc:function(){return p}});var a=n(3117),r=(n(7294),n(3905));const i={},o="Repairs API",l={unversionedId:"repairs-api/intro",id:"repairs-api/intro",title:"Repairs API",description:"GitHub Repository",source:"@site/docs/repairs-api/intro.md",sourceDirName:"repairs-api",slug:"/repairs-api/intro",permalink:"/housing-repairs-online/repairs-api/intro",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/repairs-api/intro.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Look and feel",permalink:"/housing-repairs-online/front-end/look-and-feel"},next:{title:"Endpoints",permalink:"/housing-repairs-online/category/endpoints"}},s={},p=[{value:"Frameworks used",id:"frameworks-used",level:2},{value:"Blog Storage",id:"blog-storage",level:3},{value:"Cosmos DB",id:"cosmos-db",level:3},{value:"Gov Notify",id:"gov-notify",level:3},{value:"User notifications",id:"user-notifications",level:4},{value:"Internal notification email",id:"internal-notification-email",level:4},{value:"Environment variables",id:"environment-variables",level:2},{value:"Allowed Appointment Slots",id:"allowed-appointment-slots",level:3},{value:"Health Checks",id:"health-checks",level:2}],u={toc:p};function d(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"repairs-api"},"Repairs API"),(0,r.kt)("a",{class:"badge badge--secondary",href:"https://github.com/City-of-Lincoln-Council/housing-repairs-online-api"},"GitHub Repository"),(0,r.kt)("h2",{id:"frameworks-used"},"Frameworks used"),(0,r.kt)("p",null,"Written in .Net"),(0,r.kt)("h3",{id:"blog-storage"},"Blog Storage"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("a",{parentName:"p",href:"https://docs.microsoft.com/en-gb/azure/storage/blobs/storage-blobs-introduction"},"Azure Blob storage")," is Microsoft's object storage solution for the cloud.")),(0,r.kt)("p",null,"Photos uploaded as part of the ",(0,r.kt)("a",{parentName:"p",href:"../repairs-api/endpoints/repair#body"},(0,r.kt)("inlineCode",{parentName:"a"},"description.base64img")," in save repair request body")," are uploaded to a container that can be configured via ",(0,r.kt)("a",{parentName:"p",href:"#blob-env"},"environment variables"),"."),(0,r.kt)("h3",{id:"cosmos-db"},"Cosmos DB"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("a",{parentName:"p",href:"https://docs.microsoft.com/en-us/azure/cosmos-db/introduction"},"Azure Cosmos DB")," is a fully managed NoSQL database service for modern app development.")),(0,r.kt)("p",null,"Submitted repair requests are saved in a container that is configured via ",(0,r.kt)("a",{parentName:"p",href:"#cosmos-env"},"environment variables")," and requests are saved in the following structure:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "id": "20B2459F",\n    "Postcode": "M3 0W",\n    "SOR": "N373049",\n    "Address": {\n        "Display": "123 Cute Street, LN1 3AT",\n        "LocationId": "53660030    "\n    },\n    "Location": {\n        "Value": "kitchen",\n        "Display": "Kitchen"\n    },\n    "Problem": {\n        "Value": "cupboards",\n        "Display": "Cupboards, including damaged cupboard doors"\n    },\n    "Issue": {\n        "Value": "doorHangingOff",\n        "Display": "Hanging door"\n    },\n    "ContactPersonNumber": "01234567890",\n    "Description": {\n        "PhotoUrl": "https://housingrepairsonline.blob.core.windows.net/housing-repairs-online/eb5adfb6-ed53-4f3b-90c4-7a54cc36c56a.png",\n        "Text": "Excepturi quod aute "\n    },\n    "ContactDetails": {\n        "Type": "email",\n        "Value": "luna@email.com"\n    },\n    "Time": {\n        "Value": "27th January 2022 12:00pm to 4:00pm",\n        "Display": "27th January 2022 between 12:00pm to 4:00pm"\n    },\n    "_rid": "rKg5ANy0vjoVAAAAAAAAAA==",\n    "_self": "dbs/rKg5AA==/colls/rKg5ANy0vjo=/docs/rKg5ANy0vjoVAAAAAAAAAA==/",\n    "_etag": "\\"0f00dbde-0000-1100-0000-61e5367b0000\\"",\n    "_attachments": "attachments/",\n    "_ts": 1642411643\n}\n')),(0,r.kt)("h3",{id:"gov-notify"},"Gov Notify"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("a",{parentName:"p",href:"https://docs.notifications.service.gov.uk/net.html#net-client-documentation"},"GOV.UK Notify")," lets you send emails, text messages and letters to your users.")),(0,r.kt)("p",null,"Once a repair request is saved into Cosmos DB, two notifications are sent - one\nto the user and one to the email that's configured via ",(0,r.kt)("a",{parentName:"p",href:"#email-env"},"environment variables")),(0,r.kt)("h4",{id:"user-notifications"},"User notifications"),(0,r.kt)("p",null,"Email notification template ID is configured via ",(0,r.kt)("a",{parentName:"p",href:"#n-email-env"},"environment variables"),"."),(0,r.kt)("details",null,(0,r.kt)("summary",null,"Suggested email template"),(0,r.kt)("div",null,(0,r.kt)("strong",null,"From:")," Lincoln Repairs Online ",(0,r.kt)("br",null),(0,r.kt)("strong",null,"To:")," ((",(0,r.kt)("code",null,"email")," from ",(0,r.kt)("a",{href:"../repairs-api/endpoints/repair#body"},(0,r.kt)("code",null,"contactDetails.value")),")) ",(0,r.kt)("br",null),(0,r.kt)("strong",null,"Subject:")," Repair details ((",(0,r.kt)("code",null,"repair_ref")," generated when saving into Cosmos DB)) ",(0,r.kt)("br",null),(0,r.kt)("hr",null),(0,r.kt)("p",null,"Your repair has been successfully booked."),(0,r.kt)("p",null,"Your booking details are: ",(0,r.kt)("br",null),"Booking reference: ((",(0,r.kt)("code",null,"repair_ref"),"))",(0,r.kt)("br",null),"Appointment: ((",(0,r.kt)("code",null,"appointment_time")," from ",(0,r.kt)("a",{href:"../repairs-api/endpoints/repair#body"},(0,r.kt)("code",null,"time.display")),"))"),(0,r.kt)("p",null,"You will receive a reminder the day before your appointment"))),(0,r.kt)("p",null,"SMS notification template ID is configured via ",(0,r.kt)("a",{parentName:"p",href:"#n-sms-env"},"environment variables"),"."),(0,r.kt)("details",null,(0,r.kt)("summary",null,"Suggested SMS template"),(0,r.kt)("div",null,(0,r.kt)("strong",null,"To:")," ((phone numer from ",(0,r.kt)("a",{href:"../repairs-api/endpoints/repair#body"},(0,r.kt)("code",null,"contactDetails.value")),")) ",(0,r.kt)("br",null),(0,r.kt)("hr",null),(0,r.kt)("p",null,"Lincoln Repairs Online: Your repair has been successfully booked. Your booking reference is ((",(0,r.kt)("code",null,"repair_ref"),")) and your selected appointment date is ((",(0,r.kt)("code",null,"appointment_time"),"  from",(0,r.kt)("a",{href:"../repairs-api/endpoints/repair#body"},(0,r.kt)("code",null,"time.display")),"))."))),(0,r.kt)("h4",{id:"internal-notification-email"},"Internal notification email"),(0,r.kt)("p",null,"Email notification template ID is configured via ",(0,r.kt)("a",{parentName:"p",href:"#i-email-env"},"environment variables"),"."),(0,r.kt)("details",null,(0,r.kt)("summary",null,"Suggested email template"),(0,r.kt)("div",null,(0,r.kt)("strong",null,"From:")," Lincoln Repairs Online ",(0,r.kt)("br",null),(0,r.kt)("strong",null,"To:")," ((",(0,r.kt)("code",null,"email")," from ",(0,r.kt)("a",{href:"#email-env"},(0,r.kt)("code",null,"INTERNAL_EMAIL")),")) ",(0,r.kt)("br",null),(0,r.kt)("strong",null,"Subject:")," Repair details ((",(0,r.kt)("code",null,"repair_ref")," generated when saving into Cosmos DB)) ",(0,r.kt)("br",null),(0,r.kt)("hr",null),(0,r.kt)("p",null,"A new online repair has been logged. Please add the repair to universal.",(0,r.kt)("br",null),"The repair details are:",(0,r.kt)("br",null),"Repair reference: ((",(0,r.kt)("code",null,"repair_ref"),"))",(0,r.kt)("br",null),"Property Reference: ((",(0,r.kt)("code",null,"uprn")," from ",(0,r.kt)("a",{href:"../repairs-api/endpoints/repair#body"},(0,r.kt)("code",null,"address.locationId")),"))",(0,r.kt)("br",null),"Address: ((",(0,r.kt)("code",null,"uprn")," from ",(0,r.kt)("a",{href:"../repairs-api/endpoints/repair#body"},(0,r.kt)("code",null,"address.display")),"))",(0,r.kt)("br",null),"SoR: ((",(0,r.kt)("code",null,"sor")," generated when saving into Cosmos DB ))",(0,r.kt)("br",null),"Description: ((",(0,r.kt)("code",null,"repair_desc")," from ",(0,r.kt)("a",{href:"../repairs-api/endpoints/repair#body"},(0,r.kt)("code",null,"description.text")),"))",(0,r.kt)("br",null),"Contact number: ((",(0,r.kt)("code",null,"contact_no")," from ",(0,r.kt)("a",{href:"../repairs-api/endpoints/repair#body"},(0,r.kt)("code",null,"contactPersonNumber")),"))",(0,r.kt)("br",null),"Photos uploaded: ((",(0,r.kt)("code",null,"image_1"),"))",(0,r.kt)("br",null)))),(0,r.kt)("h2",{id:"environment-variables"},"Environment variables"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Name"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"AUTHENTICATION_IDENTIFIER"),(0,r.kt)("td",{parentName:"tr",align:null},"A unique identifier used to validate access.*")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"JWT_SECRET"),(0,r.kt)("td",{parentName:"tr",align:null},"A hash secret used for encryption.*")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"../housing-management-system-api/intro"},"ADDRESSES_API_URL")),(0,r.kt)("td",{parentName:"tr",align:null},"Address API URL")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"../scheduling-api/intro"},"SCHEDULING_API_URL")),(0,r.kt)("td",{parentName:"tr",align:null},"Scheduling API URL")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("span",{id:"cosmos-env"},"COSMOS_ENDPOINT_URL")),(0,r.kt)("td",{parentName:"tr",align:null},"Cosmos endpoint URL")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"COSMOS_AUTHORIZATION_KEY"),(0,r.kt)("td",{parentName:"tr",align:null},"Cosmos authorization key")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"COSMOS_DATABASE_ID"),(0,r.kt)("td",{parentName:"tr",align:null},"Cosmos database name, e.g.: ",(0,r.kt)("inlineCode",{parentName:"td"},"housing-repairs-online"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"COSMOS_CONTAINER_ID"),(0,r.kt)("td",{parentName:"tr",align:null},"Cosmos table name, e.g.: ",(0,r.kt)("inlineCode",{parentName:"td"},"repairs-requests"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("span",{id:"blob-env"},"AZURE_STORAGE_CONNECTION_STRING")),(0,r.kt)("td",{parentName:"tr",align:null},"Blob storage connection string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"STORAGE_CONTAINER_NAME"),(0,r.kt)("td",{parentName:"tr",align:null},"Blob storage container name, e.g.: ",(0,r.kt)("inlineCode",{parentName:"td"},"housing-repairs-online"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"GOV_NOTIFY_KEY"),(0,r.kt)("td",{parentName:"tr",align:null},"Gov notification key")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("span",{id:"n-sms-env"},"CONFIRMATION_SMS_NOTIFY_TEMPLATE_ID")),(0,r.kt)("td",{parentName:"tr",align:null},"Id of the SMS template that will be sent to customers")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("span",{id:"n-email-env"},"CONFIRMATION_EMAIL_NOTIFY_TEMPLATE_ID")),(0,r.kt)("td",{parentName:"tr",align:null},"Id of the email template that will be sent to customers")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("span",{id:"i-email-env"},"INTERNAL_EMAIL_NOTIFY_TEMPLATE_ID")),(0,r.kt)("td",{parentName:"tr",align:null},"Id of the template that will be sent to staff")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("span",{id:"email-env"},"INTERNAL_EMAIL")),(0,r.kt)("td",{parentName:"tr",align:null},"Email to which internal staff emails will be sent to")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DAYS_UNTIL_IMAGE_EXPIRY"),(0,r.kt)("td",{parentName:"tr",align:null},"Number of days attached images can be accessible for")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"../alerting-and-monitoring/intro#azure-component-setup"},"SENTRY_DSN")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"https://docs.sentry.io/product/sentry-basics/dsn-explainer/"},"Sentry Data Source Name"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"SOR_CONFIGURATION_TENANT"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"sor-engine/#configuration"},"Schedule of Rates configuration")," that specifies tenant options to offer and their SoR code")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"SOR_CONFIGURATION_COMMUNAL"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"sor-engine/#configuration"},"Schedule of Rates configuration")," that specifies communal options to offer and their SoR code")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"ALLOWED_APPOINTMENT_SLOTS"),(0,r.kt)("td",{parentName:"tr",align:null},"Specifies which appointment slots are allowed (see ",(0,r.kt)("a",{parentName:"td",href:"#allowed-appointment-slots"},"below")," for details)")))),(0,r.kt)("p",null,"*"," See ",(0,r.kt)("a",{parentName:"p",href:"../apis/authentication"},"Authentication")," for more details."),(0,r.kt)("h3",{id:"allowed-appointment-slots"},"Allowed Appointment Slots"),(0,r.kt)("p",null,"The value of ",(0,r.kt)("inlineCode",{parentName:"p"},"ALLOWED_APPOINTMENT_SLOTS")," should be in JSON format and be an array of objects with ",(0,r.kt)("inlineCode",{parentName:"p"},"startTime")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"endTime")," defined, i.e."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'[\n  {\n    "startTime": "08:00:00",\n    "endTime": "12:00:00"\n  },\n  {\n    "startTime": "12:00:00",\n    "endTime": "18:00:00"\n  },\n  {\n    "startTime": "09:30:00",\n    "endTime": "14:30:00"\n  }\n]\n')),(0,r.kt)("p",null,"Both ",(0,r.kt)("inlineCode",{parentName:"p"},"startTime")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"endTime")," are mandatory.",(0,r.kt)("br",{parentName:"p"}),"\n","The value of ",(0,r.kt)("inlineCode",{parentName:"p"},"ALLOWED_APPOINTMENT_SLOTS")," will be validated on startup.\nIf it is found to be invalid (e.g. malformed JSON or missing ",(0,r.kt)("inlineCode",{parentName:"p"},"startTime")," and/or ",(0,r.kt)("inlineCode",{parentName:"p"},"endTime"),") the API will not start successfully."),(0,r.kt)("p",null,"The following is a JSON schema for the allowed appointment slots data structure:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'{\n  "$schema": "https://json-schema.org/draft/2019-09/schema",\n  "definitions": {\n    "appointmentSlotTimeSpan": {\n      "type": "object",\n      "properties": {\n        "startTime": {\n          "type": "string"\n        },\n        "endTime": {\n          "type": "string"\n        }\n      },\n      "required": [\n        "startTime",\n        "endTime"\n      ]\n    }\n  },\n  "type": "array",\n  "items": {\n    "$ref": "#/definitions/appointmentSlotTimeSpan"\n  }\n}\n')),(0,r.kt)("h2",{id:"health-checks"},"Health Checks"),(0,r.kt)("p",null,"See ",(0,r.kt)("a",{parentName:"p",href:"../apis/health-checks"},"Health Checks")," for details."),(0,r.kt)("p",null,"The API is determined to be health if:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Each Housing Repairs API it depends upon is healthy"),(0,r.kt)("li",{parentName:"ul"},"It can connect to the configured Azure Cosmos DB"),(0,r.kt)("li",{parentName:"ul"},"It can connect to the configured Azure Blob storage")))}d.isMDXComponent=!0}}]);